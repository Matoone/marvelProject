## info

### general

This is a backend technical demo, including at lots of different technologies in 1 little project.
This app could much more simpler for what it does now, no need for graphql / sql db / autoTyping / docker.
This is intended, for demonstration purpose.

### The typescript generation

The watch tools can sometimes rebuild several times. This is expected as most TS types are generated by dynamic & watchable files generation( some copied from back-end to front-end).

You can use / inherit the typescript types in src/graphql/generated. They are recompiled when you modify the schema.ts (watch mode).

You may need to restart vs code sometimes when you modify the graphql schema, but most of the time the inference is okay.

This is first personal experimentation with this tool, just was curious...

### Layers

Layers are meaned to keep every part of the backend abstract and modular. They don't need to know about each other. Dependency injection allows for easy testing with Mockups. (TODO...)

### Docker and the db

Your local db will be persisted "out of the db container" through ./db_dump.

You can use adminer to monitor the dbs with this url:
http://localhost:8080/
system: Postgresql
server: db
user: postgres
password: postgres

## Getting started

### STARTUP init env variables

1. create a .env file at root (/back-end)
2. copy/paste /.env.template content in .env
3. replace the appropriate fields with you own keys (create marvelApi account here: https://developer.marvel.com/) in the .env

### STARTUP get docker running

4. Install and launch Docker. https://docs.docker.com/get-docker/

5. In a terminal tab use "$docker-compose build" from root (/back-end)

6. In a terminal tab use "$docker-compose up" from root (/back-end)
   It can take some time to fully build and launch the first time (downloading images, initalizing containers, setting up backend, generate TS types from graphql schema, ...), just be relaxed :)
   wait for "[2] ðŸš€ Server ready at http://localhost:4000/graphql in env: development"

### STARTUP accessing your instances

7. In another terminal tab, use "$docker ps" to copy the ContainerId(left field) of your backend-container (must be "back-end_hp-back-end" or very close).

8. Use "$docker exec -it <YourContainerId> /bin/bash" to enter in bash on the container.

9. In this bash use "$knex migrate:latest" to pass the existing migrations on the dev db.
   To use knex related cli commands (rollbacks, ...) you may need to enter, use this procedure.

Your backend is running, connected with the db.

    "dev": "npm install && cross-env NODE_ENV=development && npm run gen && rimraf dist && concurrently \"tsc --watch\" \"nodemon -L dist/index.js\"",


    "npm install && cross-env NODE_ENV=development concurrently \"npm run gen\" \"tsc --watch\" \"nodemon -q dist/index.js\"",

    ssh -i "mykeypair.pem" ec2-user@ec2-13-38-1-89.eu-west-3.compute.amazonaws.com
